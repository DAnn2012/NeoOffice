Index: inc/store/object.hxx
===================================================================
RCS file: /cvs/ucb/store/inc/store/object.hxx,v
retrieving revision 1.2
diff -u -r1.2 object.hxx
--- inc/store/object.hxx	13 Mar 2001 20:37:59 -0000	1.2
+++ inc/store/object.hxx	27 Sep 2005 03:31:52 -0000
@@ -97,25 +97,6 @@
 store_handle_type * SAL_CALL query (
 	IStoreHandle * pHandle, store_handle_type *);
 
-
-/** Template helper class as type safe Reference to store_handle_type.
- */
-template<class store_handle_type>
-class OStoreHandle : public rtl::Reference<store_handle_type>
-{
-public:
-	OStoreHandle (store_handle_type * pHandle)
-		: rtl::Reference<store_handle_type> (pHandle)
-	{}
-
-	static store_handle_type * SAL_CALL query (void * pHandle)
-	{
-		return store::query (
-			static_cast<IStoreHandle*>(pHandle),
-			static_cast<store_handle_type*>(0));
-	}
-};
-
 /*========================================================================
  *
  * OStoreObject interface.
Index: source/store.cxx
===================================================================
RCS file: /cvs/ucb/store/source/store.cxx,v
retrieving revision 1.2
diff -u -r1.2 store.cxx
--- source/store.cxx	13 Mar 2001 20:49:56 -0000	1.2
+++ source/store.cxx	27 Sep 2005 03:31:53 -0000
@@ -98,6 +98,24 @@
 #include <storlckb.hxx>
 #endif
 
+/** Template helper class as type safe Reference to store_handle_type.
+ */
+template<class store_handle_type>
+class OStoreHandle : public rtl::Reference<store_handle_type>
+{
+public:
+	OStoreHandle (store_handle_type * pHandle)
+		: rtl::Reference<store_handle_type> (pHandle)
+	{}
+
+	static store_handle_type * SAL_CALL query (void * pHandle)
+	{
+		return store::query (
+			static_cast<store::IStoreHandle*>(pHandle),
+			static_cast<store_handle_type*>(0));
+	}
+};
+
 using rtl::Reference;
 using rtl::OString;
 
Index: util/makefile.mk
===================================================================
RCS file: /cvs/ucb/store/util/makefile.mk,v
retrieving revision 1.10.6.2
diff -u -r1.10.6.2 makefile.mk
--- util/makefile.mk	28 Jan 2004 16:01:52 -0000	1.10.6.2
+++ util/makefile.mk	27 Sep 2005 03:31:53 -0000
@@ -102,13 +102,21 @@
 
 # On gcc3 __Unwind_SetIP is not in supc++ but in libgcc_s.so
 .IF "$(COMID)"=="gcc3"
-.IF "$(OS)"=="FREEBSD" || "$(OS)"=="NETBSD" || "$(OS)"=="MACOSX"
+.IF "$(OS)"=="MACOSX"
+# [ed] 9/11/05 On gcc4, we no longer have the supc++ library, so use stdc++
+.IF "$(CCNUMVER)">="000400000000"
+SHL1STDLIBS+=	-lstdc++
+.ELSE
+SHL1STDLIBS+=	-lsupc++
+.ENDIF
+.ELSE
+.IF "$(OS)"=="FREEBSD" || "$(OS)"=="NETBSD"
 SHL1STDLIBS+= 	-lsupc++
 .ELSE
 SHL1STDLIBS+= 	-lsupc++ -lgcc_s
 .ENDIF
 .ENDIF
-
+.ENDIF
 
 SHL1DEF=	$(MISC)$/$(SHL1TARGET).def
 SHL1DEPN=	$(L)$/isal.lib
