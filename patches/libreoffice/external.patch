--- hsqldb/UnpackedTarball_hsqldb.mk	2015-11-25 04:55:38.000000000 -0800
+++ hsqldb/UnpackedTarball_hsqldb.mk	2016-11-13 13:52:01.000000000 -0800
@@ -27,6 +27,7 @@
 	$(if $(HSQLDB_USE_JDBC_4_1),\
 		external/hsqldb/patches/jdbc-4.1.patch \
 	) \
+	external/hsqldb/patches/hsqldb.patch \
 ))
 
 # vim: set noet sw=4 ts=4:
--- redland/ExternalProject_raptor.mk	2015-11-25 04:55:38.000000000 -0800
+++ redland/ExternalProject_raptor.mk	2017-02-25 15:18:56.000000000 -0800
@@ -45,6 +45,7 @@
 			 --enable-parsers="rdfxml ntriples turtle trig guess rss-tag-soup" \
 			--with-www=xml \
 			--without-xslt-config \
+			$(if $(filter MACOSX,$(OS)),--with-xml2-config=/usr/bin/xml2-config) \
 			$(if $(CROSS_COMPILING),--build=$(BUILD_PLATFORM) --host=$(HOST_PLATFORM)) \
 			$(if $(filter MACOSX,$(OS)),--prefix=/@.__________________________________________________OOO) \
 			$(if $(filter IOS ANDROID,$(OS)),--disable-shared,--disable-static) \
--- expat/UnpackedTarball_expat.mk	2015-11-25 04:55:38.000000000 -0800
+++ expat/UnpackedTarball_expat.mk	2017-06-25 18:29:37.000000000 -0700
@@ -12,7 +12,8 @@
 $(eval $(call gb_UnpackedTarball_set_tarball,expat,$(EXPAT_TARBALL)))
 
 $(eval $(call gb_UnpackedTarball_add_patches,expat,\
-	external/expat/expat-2.1.0.patch \
+	external/expat/expat-winapi.patch \
+	external/expat/expat-iOS.patch \
 ))
 
 # This is a bit hackish.
--- expat/expat-iOS.patch	2017-06-25 18:29:24.000000000 -0700
+++ expat/expat-iOS.patch	2017-06-25 18:31:42.000000000 -0700
@@ -0,0 +1,20 @@
+--- misc/expat-2.1.0/conftools/config.sub	2016-04-30 21:24:14.000000000 +0200
++++ misc/build/expat-2.1.0/conftools/config.sub	2017-06-11 10:56:49.000000000 +0200
+@@ -252,7 +252,7 @@
+ 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
+ 	| am33_2.0 \
+ 	| arc | arceb \
+-	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] \
++	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] | arm64 \
+ 	| avr | avr32 \
+ 	| ba \
+ 	| be32 | be64 \
+@@ -374,7 +374,7 @@
+ 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
+ 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
+ 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* | arceb-* \
+-	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
++	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* | arm64-* \
+ 	| avr-* | avr32-* \
+ 	| ba-* \
+ 	| be32-* | be64-* \
--- expat/expat-macOS.patch 2017-06-25 21:48:41.000000000 -0700
+++ expat/expat-macOS.patch	2017-06-25 21:55:54.000000000 -0700
@@ -0,0 +1,17 @@
+--- misc/expat-2.1.1/lib/xmlparse.c	2017-06-17 09:07:38.000000000 -0700
++++ misc/build/expat-2.1.1/lib/xmlparse.c	2017-06-25 21:51:02.000000000 -0700
+@@ -699,7 +699,14 @@
+ # include <errno.h>
+ 
+ # if defined(HAVE_GETRANDOM)
++#  ifdef __clang__
++#    pragma push_macro("buffer")
++#    undef buffer
++#  endif
+ #  include <sys/random.h>    /* getrandom */
++#  ifdef __clang__
++#    pragma pop_macro("buffer")
++#  endif
+ # else
+ #  include <unistd.h>        /* syscall */
+ #  include <sys/syscall.h>   /* SYS_getrandom */
